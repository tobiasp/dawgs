<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Year of the Dawg ‚Äî Hot Dog Leaderboard</title>
  <style>
    :root{
      --bg:#0b0c10;
      --card:#11131a;
      --text:#eaf0ff;
      --muted:#9aa6c4;
      --line:#232a3a;

      /* hot dog palette */
      --bun:#d7a66e;
      --bun2:#c98f4e;
      --sausage:#b34b3f;
      --ketchup:#d12a2a;
      --mustard:#f3c11a;
      --relish:#4ad66d;
      --neon:#7cffcb;

      --shadow: 0 18px 55px rgba(0,0,0,.45);
      --radius: 18px;
    }

    *{ box-sizing:border-box; }
    html{ -webkit-text-size-adjust: 100%; }
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);

      /* Hot-dog-party background (tile + gradients) */
      background-image:
        url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27240%27%20height%3D%27240%27%3E%0A%20%20%3Crect%20width%3D%27240%27%20height%3D%27240%27%20fill%3D%27none%27/%3E%0A%20%20%3Ctext%20x%3D%2718%27%20y%3D%2762%27%20font-size%3D%2736%27%3E%F0%9F%8C%AD%3C/text%3E%0A%20%20%3Ctext%20x%3D%27150%27%20y%3D%27180%27%20font-size%3D%2736%27%3E%F0%9F%8C%AD%3C/text%3E%0A%20%20%3Cpath%20d%3D%27M12%20128%20C%2045%2092%2C%2078%20164%2C%20110%20128%20S%20175%20164%2C%20228%20128%27%20fill%3D%27none%27%20stroke%3D%27%23f3c11a%27%20stroke-width%3D%277%27%20stroke-linecap%3D%27round%27%20opacity%3D%27.85%27/%3E%0A%20%20%3Cpath%20d%3D%27M18%20150%20C%2055%20175%2C%2085%20120%2C%20120%20150%20S%20185%20120%2C%20225%20150%27%20fill%3D%27none%27%20stroke%3D%27%23d12a2a%27%20stroke-width%3D%276%27%20stroke-linecap%3D%27round%27%20opacity%3D%27.55%27/%3E%0A%20%20%3Ccircle%20cx%3D%2770%27%20cy%3D%27206%27%20r%3D%276%27%20fill%3D%27%234ad66d%27%20opacity%3D%27.55%27/%3E%0A%20%20%3Ccircle%20cx%3D%27196%27%20cy%3D%2744%27%20r%3D%276%27%20fill%3D%27%234ad66d%27%20opacity%3D%27.55%27/%3E%0A%3C/svg%3E"),
        radial-gradient(1200px 800px at 20% -10%, rgba(243,193,26,.22), transparent 55%),
        radial-gradient(900px 650px at 90% 10%, rgba(209,42,42,.18), transparent 55%),
        radial-gradient(900px 650px at 70% 110%, rgba(124,255,203,.10), transparent 55%),
        linear-gradient(180deg, #090a0e 0%, #07080c 100%);
      background-size: 240px 240px, auto, auto, auto, auto;
      background-repeat: repeat, no-repeat, no-repeat, no-repeat, no-repeat;

      overflow-x:hidden;
      overflow-y:auto;
      -webkit-overflow-scrolling: touch;
      overscroll-behavior-y: contain;
    }

    a{ color: var(--neon); text-decoration:none; font-weight:700; }
    a:hover{ text-decoration:underline; }

    /* Topbar */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      backdrop-filter: blur(10px);
      background: rgba(7,8,12,.70);
      border-bottom: 1px solid rgba(35,42,58,.7);
    }
    .topbar-inner{
      max-width:1200px;
      margin:0 auto;
      padding: 14px 16px;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(180deg, rgba(215,166,110,.95), rgba(201,143,78,.92));
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      position:relative;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.06);
      flex: 0 0 auto;
    }
    .logo:before{
      content:"";
      position:absolute; inset:9px 6px;
      border-radius: 12px;
      background: linear-gradient(90deg, var(--sausage), var(--sausage));
      box-shadow: inset 0 -10px 14px rgba(0,0,0,.25);
    }
    .logo:after{
      content:"";
      position:absolute; left:0; right:0; top:0; height:100%;
      background:
        repeating-linear-gradient(
          135deg,
          rgba(243,193,26,.0) 0 14px,
          rgba(243,193,26,.22) 14px 18px
        );
      mix-blend-mode:screen;
      opacity:.65;
    }
    .title h1{
      margin:0;
      font-size:16px;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .title .sub{
      margin-top:3px;
      font-size:12px;
      color:var(--muted);
      line-height:1.2;
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(17,19,26,.55);
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
    }
    .pill label{ font-size:12px; color:var(--muted); }
    select, input[type="search"]{
      appearance:none;
      border:none;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size:13px;
      width: 170px;
    }
    input[type="search"]{ width: 220px; }
    .btn{
      border:none;
      outline:none;
      cursor:pointer;
      border-radius: 999px;
      padding:10px 12px;
      color:#0b0c10;
      background: linear-gradient(180deg, var(--mustard), #e9a600);
      box-shadow: 0 12px 30px rgba(243,193,26,.18);
      font-weight:900;
      letter-spacing:.2px;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }
    .toggle{
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
      cursor:pointer;
      font-size:12px;
      color:var(--muted);
    }
    .toggle input{ accent-color: var(--mustard); }

    main{
      max-width:1200px;
      margin:0 auto;
      padding: 16px;
      padding-bottom: 56px;
    }

    /* Layout */
    .layout{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 980px){
      .layout{ grid-template-columns: 1fr; }
      input[type="search"]{ width: 160px; }
    }
    @media (max-width: 420px){
      .title .sub{ display:none; }
      input[type="search"]{ width: 150px; }
      select{ width: 135px; }
    }

    /* Card */
    .card{
      background: linear-gradient(180deg, rgba(17,19,26,.92), rgba(13,15,20,.86));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card-header{
      padding:14px 14px 10px 14px;
      border-bottom: 1px solid rgba(35,42,58,.7);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .card-header h2{
      margin:0;
      font-size:14px;
      letter-spacing:.2px;
    }
    .hint{ font-size:12px; color: var(--muted); }
    .card-body{ padding:14px; }

    /* Stats */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:12px;
    }
    @media (max-width: 700px){
      .stats{ grid-template-columns: 1fr; }
    }
    .stat{
      padding:12px;
      border-radius: 16px;
      background: rgba(15,18,24,.72);
      border: 1px solid rgba(255,255,255,.06);
      overflow:hidden;
    }
    .stat .k{ font-size:12px; color:var(--muted); }
    .stat .v{ margin-top:6px; font-size:18px; font-weight:900; letter-spacing:.2px; }
    .spark{
      margin-top:8px;
      height:8px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.05);
    }
    .spark > span{
      display:block;
      height:100%;
      width:40%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--relish), var(--neon));
      opacity:.9;
    }

    /* Table */
    .table-wrap{
      margin-top: 10px;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.05);
      background: rgba(0,0,0,.15);
    }
    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      font-size:13px;
      min-width: 680px;
    }
    thead th{
      text-align:left;
      font-size:11px;
      color: var(--muted);
      font-weight:800;
      letter-spacing:.3px;
      text-transform:uppercase;
      padding:10px 10px;
      border-bottom: 1px solid rgba(35,42,58,.7);
      position: sticky;
      top: 0;
      background: rgba(10,12,16,.92);
      backdrop-filter: blur(8px);
      z-index: 2;
    }
    tbody td{
      padding:12px 10px;
      border-bottom: 1px solid rgba(35,42,58,.45);
      vertical-align:middle;
    }
    tbody tr:hover{ background: rgba(243,193,26,.06); }

    .rank{ font-weight:900; font-size:12px; width: 54px; color: var(--mustard); }
    .namecell{ display:flex; align-items:center; gap:10px; min-width: 220px; }
    .avatar{
      width:34px; height:34px;
      border-radius: 12px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      color: var(--text);
      font-weight:900;
      font-size:12px;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .avatar img{ width:100%; height:100%; object-fit:cover; display:block; }
    .name{ display:flex; flex-direction:column; line-height:1.15; }
    .name b{ font-size:13px; }
    .name span{ font-size:11px; color: var(--muted); }

    .count{ font-weight:900; font-size:14px; }
    .bar{
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.05);
      min-width: 140px;
    }
    .bar > span{
      display:block;
      height:100%;
      width:10%;
      border-radius:999px;
      background: linear-gradient(90deg, var(--ketchup), var(--mustard));
    }

    .chip{
      font-size:11px;
      padding:6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.08);
      background: rgba(15,18,24,.55);
      color: var(--muted);
      display:inline-flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
    }
    .chip strong{ color: var(--text); }

    /* Feed */
    .feed{ display:flex; flex-direction:column; gap:12px; }
    .post{
      display:grid;
      grid-template-columns: 128px 1fr;
      gap:12px;
      padding:12px;
      border-radius: 16px;
      background: rgba(15,18,24,.72);
      border: 1px solid rgba(255,255,255,.06);
      overflow:hidden;
    }
    @media (max-width: 420px){
      .post{ grid-template-columns: 1fr; }
    }
    .thumb{
      width:128px;
      height:128px;
      border-radius: 16px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      position:relative;
    }
    @media (max-width: 420px){
      .thumb{ width:100%; height:auto; aspect-ratio: 1 / 1; }
    }
    .thumb img{ width:100%; height:100%; object-fit:cover; display:block; }
    .thumb:after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(60px 60px at 20% 10%, rgba(255,255,255,.25), transparent 55%);
      pointer-events:none;
    }
    .meta{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; }
    .meta b{ font-size:13px; }
    .meta .t{ font-size:11px; color:var(--muted); }
    .post p{ margin:6px 0 0 0; font-size:12.5px; line-height:1.3; }

    /* Shame board */
    .shame{
      margin-top: 14px;
      background: linear-gradient(180deg, rgba(209,42,42,.16), rgba(15,18,24,.70));
      border: 1px solid rgba(209,42,42,.25);
    }
    .shame h3{ margin:0 0 8px 0; font-size:13px; }
    .shame .small{ color: var(--muted); font-size:12px; margin:0 0 10px 0; }
    .two-cols{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width: 700px){ .two-cols{ grid-template-columns: 1fr; } }
    .shame ul{ margin:0; padding:0 0 0 18px; }
    .shame li{ margin:6px 0; }

    /* Footer */
    .footer{
      margin-top:16px;
      color: var(--muted);
      font-size:12px;
      text-align:center;
      padding: 10px 0 22px 0;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      padding:2px 6px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.35);
      font-size:11px;
      color: var(--text);
    }

    /* Toast + confetti */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: rgba(17,19,26,.92);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding:10px 12px;
      box-shadow: var(--shadow);
      color: var(--text);
      font-size:12px;
      display:none;
      gap:10px;
      align-items:center;
      max-width: 92vw;
      z-index: 99;
    }
    .toast.show{ display:flex; animation: pop .25s ease-out; }
    @keyframes pop{
      from{ transform:translateX(-50%) translateY(8px); opacity:0; }
      to{ transform:translateX(-50%) translateY(0); opacity:1; }
    }
    .confetti{
      position:fixed;
      inset:0;
      pointer-events:none;
      overflow:hidden;
      z-index:80;
    }
    .confetti i{
      position:absolute;
      font-size: 24px;
      line-height: 1;
      background: none;
      width:auto;height:auto;
      opacity:.95;
      transform: translate3d(0,-12vh,0) rotate(0deg);
      animation: fallEmoji 1.9s linear forwards;
      filter: drop-shadow(0 8px 16px rgba(0,0,0,.45));
      user-select:none;
      will-change: transform;
    }
    @keyframes fallEmoji{
      to{
        transform: translate3d(var(--drift, 0px), 110vh, 0) rotate(540deg);
        opacity:1;
      }
    }
}
  
    
    /* Intro animation: flying dawg gets eaten */
    .intro-scene{
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 120;
      opacity: 1;
    }
    .intro-scene.done{
      opacity: 0;
      transition: opacity .25s ease-out;
    }
    .intro-caption{
      position:absolute;
      left: 14px;
      top: 84px;
      font-weight: 900;
      font-size: 14px;
      letter-spacing: .2px;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(17,19,26,.80);
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      transform: translateY(-8px);
      opacity: 0;
      animation: introCaptionIn .35s ease-out forwards .15s;
    }
    @keyframes introCaptionIn{
      to{ transform: translateY(0); opacity: 1; }
    }
    .intro-human{
      position:absolute;
      right: 10px;
      top: 110px;
      font-size: 64px;
      transform: translateX(120px);
      opacity: 0;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,.45));
      animation: humanIn .45s ease-out forwards .25s;
    }
    .intro-fork{
      position:absolute;
      right: 78px;
      top: 160px;
      font-size: 40px;
      transform: translateX(160px) rotate(-20deg);
      opacity: 0;
      animation: forkIn .55s ease-out forwards .28s;
      filter: drop-shadow(0 12px 30px rgba(0,0,0,.45));
    }
    @keyframes humanIn{ to{ transform: translateX(0); opacity: 1; } }
    @keyframes forkIn{ to{ transform: translateX(0) rotate(10deg); opacity: 1; } }

    .intro-dawg{
      position:absolute;
      left: -110px;
      top: 128px;
      font-size: 86px;
      filter: drop-shadow(0 16px 38px rgba(0,0,0,.60));
      animation: dawgFly 3.2s cubic-bezier(.2,.9,.2,1) forwards .15s;
    }
    .intro-dawg::after{
      content:"";
      position:absolute;
      left:-80px;
      top: 50%;
      width: 90px;
      height: 12px;
      transform: translateY(-50%);
      background: linear-gradient(90deg, rgba(243,193,26,.0), rgba(243,193,26,.35), rgba(209,42,42,.25), rgba(74,214,109,.22), rgba(124,255,203,.0));
      border-radius: 999px;
      filter: blur(1px);
      opacity: .9;
    }
    @keyframes dawgFly{
      0%{ transform: translateX(-10vw) rotate(-14deg) scale(1); opacity: 1; }
      70%{ transform: translateX(calc(74vw)) rotate(10deg) scale(1.10); opacity: 1; }
      88%{ transform: translateX(calc(82vw)) rotate(4deg) scale(.62); opacity: 1; }
      100%{ transform: translateX(calc(84vw)) rotate(0deg) scale(.28); opacity: 0; }
    }

    @media (max-width: 520px){
      .table-wrap{ margin-top: 8px; }
      table{
        min-width: 0;
        font-size: 12px;
        table-layout: fixed;
      }
      thead th{ padding: 8px 8px; font-size:10px; }
      tbody td{ padding: 10px 8px; }

      thead th:nth-child(1){ width: 44px; }
      thead th:nth-child(3){ width: 54px; }
      thead th:nth-child(4){ width: 92px; }
      thead th:nth-child(5){ width: 92px; }

      .rank{ width: 44px; font-size:11px; }
      .namecell{ min-width: 0; gap:8px; }
      .avatar{ width:28px; height:28px; border-radius:10px; }
      .name b{ font-size:12px; }
      .name span{
        max-width: 150px;
        overflow:hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display:block;
      }

      .count{ font-size:13px; }
      .bar{ min-width: 0; width: 92px; height:8px; }
      .chip{ font-size:10px; padding:4px 6px; }
    }
      .intro-human{ top: 96px; font-size: 64px; }
      .intro-fork{ top: 142px; font-size: 36px; right: 70px; }
      .intro-dawg{ top: 116px; font-size: 76px; }
    }

    /* Compact leaderboard table on phones (aim: no horizontal scroll for most) */
    @media (max-width: 520px){
      .table-wrap{ margin-top: 8px; }
      table{ min-width: 0; font-size: 12px; }
      thead th{ padding: 8px 8px; font-size:10px; }
      tbody td{ padding: 10px 8px; }

      .rank{ width: 42px; font-size:11px; }
      .namecell{ min-width: 170px; gap:8px; }
      .avatar{ width:28px; height:28px; border-radius:10px; }
      .name b{ font-size:12px; }
      .name span{
        max-width: 140px;
        overflow:hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        display:block;
      }

      .count{ font-size:13px; }
      .bar{ min-width: 92px; height:8px; }
      .chip{ font-size:10px; padding:4px 6px; }
    }

  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <h1>Year of the Dawg ‚Äî Hot Dog Leaderboard</h1>
          <div class="sub">Eat ‚Ä¢ Post ‚Ä¢ Ascend ‚Ä¢ Repeat. (Season runs <b>Jan 1, 2026 ‚Üí Dec 31, 2026</b>.)</div>
        </div>
      </div>

      <div class="controls">
        <div class="pill">
          <label for="scope">Scope</label>
          <select id="scope" title="Filter by time window">
            <option value="all">All time</option>
            <option value="7">Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 90 days</option>
          </select>
        </div>

        <div class="pill">
          <label for="q">Search</label>
          <input id="q" type="search" placeholder="Name or email‚Ä¶" />
        </div>

        <button class="btn" id="refreshNow" title="Fetch latest sheet data now">REFRESH NOW</button>
        <button class="btn" id="celebrate" title="Celebrate the current top Dawg">HAIL THE TOP DAWG</button>

        <label class="toggle" title="Turns up the trash-talk.">
          <input id="spicy" type="checkbox" checked/>
          Spicy Mode üå∂Ô∏è
        </label>
      </div>
    </div>
  </div>

  <main>
    <div class="layout">
      <!-- LEFT: Leaderboard -->
      <section class="card">
        <div class="card-header">
          <div>
            <h2>Leaderboard</h2>
            <div class="hint" id="asof">‚Äî</div>
          </div>
          <div class="hint">Tip: click a row to copy a callout.</div>
        </div>
        <div class="card-body">
          <div class="stats">
            <div class="stat">
              <div class="k">Total Dawgs Logged</div>
              <div class="v" id="totalDogs">‚Äî</div>
              <div class="spark"><span id="spark1"></span></div>
            </div>
            <div class="stat">
              <div class="k">Top Dawg</div>
              <div class="v" id="topDawg">‚Äî</div>
              <div class="spark"><span id="spark2"></span></div>
            </div>
            <div class="stat">
              <div class="k">Days Left (to Dec 31, 2026)</div>
              <div class="v" id="daysLeft">‚Äî</div>
              <div class="spark"><span id="spark3"></span></div>
            </div>

            <div class="stat" style="grid-column: 1 / -1;">
              <div class="k">Cheesy Dawg Quote of the Day</div>
              <div class="v" id="dailyQuote" style="font-size:14px; line-height:1.25;">‚Äî</div>
              <div style="margin-top:8px; display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                <span class="chip">üïí <strong id="lastRefresh">Not refreshed yet</strong></span>
                <span class="chip">üîÅ Auto-refresh every <strong id="refreshIntervalLabel">5</strong> min</span>
                <span class="chip">‚å®Ô∏è <strong>/</strong> search ‚Ä¢ <strong>Esc</strong> clear</span>
              </div>
            </div>
          </div>

          <div class="table-wrap">
            <table aria-label="Leaderboard table">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Dawg</th>
                  <th>Count</th>
                  <th>Heat</th>
                  <th>Last Seen</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RIGHT: Latest -->
      <section class="card">
        <div class="card-header">
          <div>
            <h2>Latest Submissions</h2>
            <div class="hint">Fresh dawgs, fresh receipts.</div>
          </div>
          <div class="hint"><span class="chip">üî• <strong id="latestCount">‚Äî</strong> recent posts</span></div>
        </div>
        <div class="card-body">
          <div class="feed" id="feed"></div>

          <div class="card shame">
            <div class="card-body">
              <h3>Hall of (Friendly) Shame</h3>
              <p class="small">Low counts only. This is peer pressure with a warm hug.</p>
              <div class="two-cols">
                <div>
                  <div class="chip">ü•∂ Cold bun energy</div>
                  <ul id="shameList"></ul>
                </div>
                <div>
                  <div class="chip">üì£ Suggested heckles</div>
                  <ul id="heckles"></ul>
                </div>
              </div>
            </div>
          </div>

        </div>
      </section>
    </div>

    <div class="footer">
      Data: Google Sheet + Drive photos. If images don‚Äôt load, you probably need Drive access in your browser.
      <br/>
      Keyboard: <span class="kbd">/</span> focuses search, <span class="kbd">Esc</span> clears it.
    </div>
  </main>


  <div class="intro-scene" id="introScene" aria-hidden="true">
    <div class="intro-caption">A wild dawg appears‚Ä¶ (oh no)</div>
    <div class="intro-human">üòã</div>
    <div class="intro-fork">üç¥</div>
    <div class="intro-dawg">üå≠</div>
  </div>

  <div class="confetti" id="confetti"></div>
  <div class="toast" id="toast"></div>

<script>
/* =========================
   CONFIG
========================= */
const SHEET_ID = "17Y2SosZ5wmAjsB1FUyr2AOy3r7-PjMdOC1Mfhkur4ws";
const TAB_TALLY = "Active Tally";
const TAB_RESPONSES = "Form Responses";
const AUTO_REFRESH_MIN = 5;
const FEED_LIMIT = 10;
const LOAD_SUBMISSIONS_LIMIT = 400;

/* =========================
   FALLBACK DATA
========================= */
let PARTICIPANTS = [
  {email:"jackjharding@gmail.com", name:"Jack", count:16},
  {email:"topolepaige@gmail.com", name:"Paige", count:15},
  {email:"rcaterson@gmail.com", name:"rosh", count:9},
  {email:"mapignone@gmail.com", name:"Meg Pignone", count:8},
  {email:"jacwilso1995@gmail.com", name:"Jacob", count:7},
  {email:"jamilmp20@gmail.com", name:"Jamil Moore-Prewitt", count:6},
  {email:"mikephamtastic@gmail.com", name:"Mike Pham", count:5},
  {email:"renn.maeve@gmail.com", name:"ren", count:5},
  {email:"brad.faught@gmail.com", name:"Brad Faught", count:5},
  {email:"hoperosefaith@gmail.com", name:"Hope", count:4},
  {email:"maxcobywilson@gmail.com", name:"Max Wilson", count:4},
  {email:"akushner0@gmail.com", name:"Alexa", count:3},
  {email:"aditi.narve@gmail.com", name:"Aditi", count:3},
  {email:"ramchandjn89@gmail.com", name:"Ram", count:2},
  {email:"hadawayh2@gmail.com", name:"Hannah", count:2},
  {email:"dshumatejr2@gmail.com", name:"David Shumate", count:1},
  {email:"cflfantasycommish@gmail.com", name:"Zac", count:1},
];

let SUBMISSIONS = []; // will be loaded live

/* =========================
   STRINGS
========================= */
const HECKLES_MILD = [
  "Not saying you‚Äôve got cold bun energy‚Ä¶ but your bun is literally room temp.",
  "One dog today = one less personality trait tomorrow. Choose wisely.",
  "Post a dog. Feed the spreadsheet. Obey the Dawgocracy.",
  "You don‚Äôt need motivation ‚Äî you need mustard.",
  "This leaderboard won‚Äôt fix your problems, but it will expose them.",
  "Consider this your gentle nudge toward a bun.",
  "The tally is hungry. So should you be.",
  "If you‚Äôre reading this, you have time to eat a dog.",
  "A hot dog is cheaper than therapy. Allegedly.",
  "Your future self wants the points.",
  "No shame, just‚Ä¶ mild concern.",
  "Friendly reminder: the bun remembers.",
  "Do it for the spreadsheet. It‚Äôs doing its best.",
  "One photo = one less excuse.",
  "We believe in you (barely).",
  "Momentum starts with one dog.",
  "Today‚Äôs forecast: 90% chance of mustard.",
  "If you can scroll this, you can chew.",
  "Buns before grudges.",
  "Be the person your tally thinks you are."
];

const HECKLES_SPICY = [
  "You‚Äôre not ‚Äòsaving room‚Äô ‚Äî you‚Äôre dodging greatness. Fix it.",
  "At this point the bun has more ambition than you do.",
  "If you don‚Äôt post a dog soon, we‚Äôre filing you under ‚Äòmythical creature.‚Äô",
  "Your count is low enough to be a rumor. Make it real.",
  "Stop spectating. Start chewing. The spreadsheet wants blood (ketchup).",
  "Your tally is embarrassing in a very fixable way.",
  "The leaderboard called. It asked if you‚Äôre okay.",
  "You‚Äôre acting like hot dogs are a conspiracy. Eat one.",
  "Right now you‚Äôre losing to people with mustard on their sleeves.",
  "You‚Äôre not behind. You‚Äôre just‚Ä¶ aggressively not trying.",
  "We can‚Äôt respect your excuses and your bunlessness at the same time.",
  "Post one dog. Minimum. Then talk.",
  "Your points are giving ‚ÄòAFK‚Äô.",
  "If you‚Äôre last, at least be last with pride (and ketchup).",
  "This is a competition, not a silent retreat.",
  "Your hunger is fictional. Prove it isn‚Äôt.",
  "We‚Äôve seen plants with more drive.",
  "The spreadsheet is disappointed but still hopeful. Barely.",
  "No dog? No peace.",
  "Stop being a background character in your own bun story."
];

/* =========================
   HELPERS
========================= */
const $ = (sel) => document.querySelector(sel);

function showToast(msg) {
  const t = $("#toast");
  t.textContent = msg;
  t.classList.add("show");
  clearTimeout(showToast._timer);
  showToast._timer = setTimeout(()=>t.classList.remove("show"), 2400);
}

function spicyOn(){ return $("#spicy").checked; }

function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#039;");
}

function driveIdFromUrl(url){
  const m = String(url||"").match(/[?&]id=([^&]+)/);
  return m ? m[1] : null;
}
function driveThumb(url){
  const id = driveIdFromUrl(url);
  if(!id) return null;
  return `https://drive.google.com/thumbnail?id=${id}&sz=w400-h400`;
}

function initials(nameOrEmail){
  const s = (nameOrEmail || "").trim();
  if(!s) return "??";
  const parts = s.split(/\s+/).filter(Boolean);
  if(parts.length === 1) return parts[0].slice(0,2).toUpperCase();
  return (parts[0][0] + parts[parts.length-1][0]).toUpperCase();
}

function parseDate(s){
  if (s instanceof Date) return s;
  if (typeof s === "number") return new Date(s);
  const str = String(s ?? "").trim();
  if (!str) return new Date(NaN);

  // GViz date string: Date(YYYY,MM,DD,hh,mm,ss)
  const m = str.match(/^Date\((\d+),(\d+),(\d+)(?:,(\d+),(\d+),(\d+))?\)$/);
  if (m) {
    return new Date(
      Number(m[1]),
      Number(m[2]),
      Number(m[3]),
      Number(m[4] || 0),
      Number(m[5] || 0),
      Number(m[6] || 0)
    );
  }

  let cleaned = str.replace(/\.\d+$/, "");
  if (/^\d{4}-\d{2}-\d{2}\s+\d/.test(cleaned)) cleaned = cleaned.replace(" ", "T");
  let d = new Date(cleaned);
  if (!isNaN(d.getTime())) return d;

  d = new Date(cleaned + "Z");
  return d;
}

function fmtDate(s){
  const d = parseDate(s);
  if (!d || isNaN(d.getTime())) return String(s ?? "");
  return d.toLocaleString([], {month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
}

async function copyText(s){
  try {
    await navigator.clipboard.writeText(s);
    showToast("Copied. Go bully lovingly üå≠");
  } catch(e) {
    showToast("Couldn‚Äôt copy (clipboard blocked).");
  }
}

function confettiBurst(){
  const root = $("#confetti");
  root.innerHTML = "";
  const n = 150;
  for(let i=0;i<n;i++){
    const p = document.createElement("i");
    const roll = Math.random();
    p.textContent = roll < 0.78 ? "üå≠" : (roll < 0.92 ? "‚ú®" : "üí´");
    p.style.left = (Math.random()*100) + "vw";
    p.style.setProperty("--drift", ((Math.random()*2-1)*140).toFixed(0) + "px");
    p.style.animationDelay = (Math.random()*0.35) + "s";
    p.style.animationDuration = (1.7 + Math.random()*1.6) + "s";
    p.style.fontSize = (18 + Math.random()*20) + "px";
    root.appendChild(p);
  }
  setTimeout(()=>root.innerHTML="", 3600);
}

function animateInt(el, toValue){
  const to = Number(toValue) || 0;
  const from = Number(el.dataset.v || String(el.textContent || "0").replace(/,/g,"")) || 0;
  if(from === to){
    el.dataset.v = String(to);
    el.textContent = to.toLocaleString();
    return;
  }
  const start = performance.now();
  const dur = 420;
  function step(now){
    const t = Math.min(1, (now - start) / dur);
    const eased = 1 - Math.pow(1 - t, 3);
    const v = Math.round(from + (to - from) * eased);
    el.textContent = v.toLocaleString();
    if(t < 1) requestAnimationFrame(step);
    else el.dataset.v = String(to);
  }
  requestAnimationFrame(step);
}

/* =========================
   DIVERSE COMMENTARY
========================= */
function hashSeed(str){
  let h = 2166136261;
  for (let i=0;i<str.length;i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}
function randFromSeed(seed){
  let t = seed + 0x6D2B79F5;
  t = Math.imul(t ^ (t >>> 15), 1 | t);
  t ^= t + Math.imul(t ^ (t >>> 7), 61 | t);
  return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
}

function pickComment(name, spicy, submissionKey, usedSet){
  // Rotate commentary daily so the feed doesn't get stale over the year.
  const day = dailySeed();

  const POOL_MILD = [
    "Spreadsheet fed. Society improved.",
    "Bun integrity: strong. Commitment: stronger.",
    "Condiments chose chaos (in the best way).",
    "A tasteful dog. A reckless timestamp. Perfect.",
    "This is what leadership looks like (in a bun).",
    "Audacious. Carby. Inspirational.",
    "That‚Äôs a dog you introduce to your parents.",
    "Balanced portfolio: bun, dog, chaos.",
    "Another receipt for the Dawgocracy archives.",
    "Clean work. No notes. Carry on.",
    "We‚Äôre calling this one ‚Äúperformance art.‚Äù",
    "A humble flex ‚Äî but still a flex.",
    "Honestly? Efficient. Respect.",
    "That dog looks like it had a mission statement.",
    "Eat. Post. Repeat. You understood the assignment.",
    "This is the kind of evidence a jury would accept.",
    "Shoutout to the bun for showing up today.",
    "Absolute professionalism (for a hot dog photo).",
    "Your future self will thank you (maybe).",
    "Pure ‚ÄúI had things to prove‚Äù energy.",
    "We are witnessing bun-based excellence.",
    "The dog looks innocent. The intentions do not.",
    "This is quality documentation. A+ compliance.",
    "That‚Äôs a clean +1. Efficient, ruthless, beautiful.",
    "A dog so confident it could host a podcast.",
    "The bun clocked in. The dog clocked out.",
    "This is what ‚Äòshowing up‚Äô looks like.",
    "A tasteful amount of chaos. Respect.",
    "This dog has ‚Äòteam player‚Äô energy.",
    "It‚Äôs giving: steady progress, elite focus.",
    "Not a meal. A lifestyle update.",
    "You understood the social contract: photo or it didn‚Äôt happen.",
    "High effort bun work. The people notice.",
    "This is a public service announcement in edible form.",
    "The spreadsheet is purring.",
    "No notes. Only applause. And mustard.",
    "This dog has big ‚Äòpromotion packet‚Äô vibes.",
    "The angles? The confidence? The receipts? Perfect.",
    "A glorious little crime of convenience.",
    "The bun-to-dog ratio is between you and your conscience.",
    "We love a consistent contributor.",
    "This is a healthy relationship with documentation.",
    "The dog looks like it was assembled with purpose.",
    "This is what victory smells like (a little).",
    "A calm, steady climb. We see it.",
    "Absolute bun discipline. Rare trait.",
    "The condiments are tasteful. The ambition is not subtle.",
    "Iconic. Appropriate. Spreadsheet-worthy.",
    "This is the kind of evidence historians will study.",
    "You posted like a professional. Disturbing. Admirable.",
    "A dog that says ‚ÄúI have my life together.‚Äù",
    "Sensible. Efficient. Deliciously recorded.",
    "A well-documented win.",
    "That‚Äôs a dog with good posture.",
    "A dog that makes other dogs feel insecure.",
    "The bun did not come to play.",
    "The dog is humble. The result is not.",
    "Clean craftsmanship. Zero drama. Perfect.",
    "This is how you build a legacy: one bun at a time.",
    "We accept this offering."
  ];

  const POOL_SPICY = [
    "Unhinged hot dog conduct. We respect the audacity.",
    "That dog just got speedrun‚Äôd. No survivors. Iconic.",
    "This isn‚Äôt lunch ‚Äî it‚Äôs a power move with condiments.",
    "Violent bun energy. Absolutely feral. Love that for you.",
    "You ate like you‚Äôre trying to frighten the leaderboard. Effective.",
    "This photo has ‚Äòno regrets‚Äô energy and it‚Äôs terrifying.",
    "The bun looks innocent. The vibe does not.",
    "If confidence were calories, this would be illegal.",
    "That‚Äôs not a snack ‚Äî that‚Äôs a warning shot.",
    "Culinary menace behavior. Compliment.",
    "The spreadsheet is blushing. Keep going.",
    "You didn‚Äôt eat a dog ‚Äî you erased it from history.",
    "This is what ‚Äòcompetitive‚Äô tastes like.",
    "Somebody call the league office. This is suspiciously strong.",
    "That‚Äôs the kind of dog that gets you audited (by friends).",
    "The mustard is doing crimes and I support it.",
    "You posted like you were mad at mercy.",
    "A hot dog photo so bold it needs a PR team.",
    "Main character at the food court. I see you.",
    "Every bite sounded like a victory speech.",
    "This is borderline heroic (and slightly alarming).",
    "That dog didn‚Äôt stand a chance. Neither will your opponents.",
    "You‚Äôre not eating ‚Äî you‚Äôre making a statement.",
    "This is the energy that ruins group chats (in a good way).",
    "The bun is scared. The leaderboard is shaking.",
    "That‚Äôs not documentation ‚Äî that‚Äôs intimidation.",
    "The dog was deleted. The receipt remains.",
    "You‚Äôre feeding the spreadsheet like it owes you money.",
    "This is what ‚Äòpressure‚Äô looks like.",
    "You‚Äôre not competing. You‚Äôre threatening.",
    "Absolute menace behavior. Compliment. Again.",
    "This dog got treated like an inbox at 4:59pm.",
    "You are doing damage. Respectfully.",
    "That‚Äôs a ‚Äòdo not invite me to brunch‚Äô photo.",
    "You posted a dog like you had beef with carbs.",
    "The condiments are loud. You are louder.",
    "That bun is a hostage situation.",
    "This is bun-based domination.",
    "A dog so aggressive it should come with a warning label.",
    "You‚Äôre speedrunning the year and it shows.",
    "This is why other people feel unsafe (hungry).",
    "This looks like it was eaten with intent.",
    "If the leaderboard had emotions, it would be crying.",
    "You‚Äôre not here to participate. You‚Äôre here to conquer.",
    "This is how legends get created (and arteries get tested).",
    "The photo screams ‚ÄúI‚Äôm not sorry.‚Äù Incredible.",
    "The bun said ‚Äúplease.‚Äù You said ‚Äúno.‚Äù",
    "This is what ‚Äòcompetitive spirit‚Äô looks like in HD.",
    "You‚Äôre cooking with disrespect.",
    "The dog was an innocent bystander.",
    "This is a hostile takeover of lunchtime.",
    "You posted that like it‚Äôs evidence in court. Dangerous.",
    "The spreadsheet is begging for mercy.",
    "That‚Äôs a ‚Äúwatch me‚Äù dog.",
    "This is pure leaderboard violence (ketchup edition).",
    "You are a problem. For everyone else.",
    "That‚Äôs not a dog ‚Äî that‚Äôs a declaration.",
    "Bun confidence at historic highs.",
    "This is why they invented tallies."
  ];

  const EXTRAS_MILD = [
    `${name} is on a roll. Literally.`,
    `${name} keeps the Dawgocracy alive.`,
    `${name} chose joy (and sodium).`,
    `${name} understood the assignment.`,
    `${name} is building a legacy, one bun at a time.`,
    `${name} is quietly farming W‚Äôs.`,
    `${name} is making the rest of us look lazy.`,
    `${name} came, saw, and chewed.`,
    `${name} is keeping it honest.`,
    `${name} is putting points on the board.`,
    `${name} is practicing consistency like a pro.`,
    `${name} is making ‚Äòsteady‚Äô look scary.`,
    `${name} is bringing disciplined bun energy.`,
    `${name} is doing the right thing (for the spreadsheet).`,
    `${name} is setting an example (unfortunately).`,
    `${name} is adding lore to this competition.`
  ];

  const EXTRAS_SPICY = [
    `${name} chose chaos and condiments.`,
    `${name} woke up and said ‚Äúbun.‚Äù`,
    `${name} is farming W‚Äôs and cholesterol.`,
    `${name} is speedrunning this season.`,
    `${name} is making it look personal.`,
    `${name} is allergic to losing.`,
    `${name} is doing damage (to the leaderboard).`,
    `${name} is cooking with disrespect.`,
    `${name} is out here collecting receipts.`,
    `${name} is a problem (for everyone else).`,
    `${name} is turning lunch into a spectacle.`,
    `${name} is bullying the standings.`,
    `${name} is running up the score.`,
    `${name} is making the rest of you nervous.`,
    `${name} is choosing violence (mustard).`,
    `${name} is behaving like a final boss.`
  ];

  const pool = spicy ? POOL_SPICY : POOL_MILD;
  const extras = spicy ? EXTRAS_SPICY : EXTRAS_MILD;

  const key = String(submissionKey || name || "");
  // Include day + spicy toggle so the same submission gets new lines over time.
  const seed = hashSeed(key + "|" + day + "|" + (spicy ? "S" : "M"));
  let r = randFromSeed(seed);
  let idx = Math.floor(r * pool.length);

  if (usedSet && usedSet.has(idx)) {
    // bump deterministically to avoid duplicates in the visible feed
    idx = (idx + 1 + Math.floor(r * 11)) % pool.length;
  }
  if (usedSet) usedSet.add(idx);

  let base = pool[idx];

  // 65% chance of an extra line
  r = randFromSeed(seed ^ 0x9E3779B9);
  if (r < 0.65) {
    const j = Math.floor(randFromSeed(seed ^ 0x85EBCA6B) * extras.length);
    base = `${base} ${extras[j]}`;
  }

  // 18% chance of a quick kicker line
  r = randFromSeed(seed ^ 0xC2B2AE35);
  if (r < 0.18) {
    const kickers = spicy
      ? ["No witnesses. Only buns.", "The spreadsheet saw everything.", "This is why we can‚Äôt have nice diets.", "Another one. Again. Relentless."]
      : ["Strong showing.", "Good form.", "Certified.", "We accept this offering."];
    base = `${base} ${kickers[Math.floor(randFromSeed(seed ^ 0x27D4EB2F) * kickers.length)]}`;
  }

  return base;
}

/* =========================
   DAILY QUOTE
========================= */
function seededRandFromString(seedStr){
  let h = 2166136261;
  for(let i=0;i<seedStr.length;i++) {
    h ^= seedStr.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return function(){
    h += 0x6D2B79F5;
    let t = Math.imul(h ^ (h >>> 15), 1 | h);
    t ^= t + Math.imul(t ^ (t >>> 7), 61 | t);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}
function dailySeed(){
  const d = new Date();
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,"0");
  const day = String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}
function buildDailyQuote(rows, subs){
  const r = seededRandFromString(dailySeed() + (spicyOn() ? "|spicy" : "|mild"));
  const pick = (arr)=> arr[Math.floor(r()*arr.length)];

  const top = rows[0];
  const bottom = rows.slice().filter(x => (x.displayName||"").toLowerCase() !== "unknown")
    .sort((a,b)=>(Number(a.count)||0)-(Number(b.count)||0))[0];
  const recent = subs[0];

  const mild = [
    `üå≠ ‚ÄúA hot dog posted is a hot dog that counts.‚Äù Today: ${top?.displayName||"someone"} is leading with ${top?.count||0}. ${bottom?.displayName||"someone"} is building suspense at ${bottom?.count||0}.`,
    `üå≠ ‚ÄúIt‚Äôs not a phase ‚Äî it‚Äôs a lifestyle.‚Äù Shoutout to ${recent?.name||"the latest legend"} for feeding the spreadsheet.`,
    `üå≠ ‚ÄúRespect the bun. Fear the tally.‚Äù One dog today prevents tomorrow‚Äôs shame.`,
    `üå≠ ‚ÄúDog + carb = destiny.‚Äù If you‚Äôre behind, that‚Äôs just plot development.`,
    `üå≠ ‚ÄúEvidence wins.‚Äù Photo, timestamp, glory. That‚Äôs the whole religion.`
  ];

  const spicy = [
    `üå≠ ‚ÄúThe spreadsheet is eternal, and it has receipts.‚Äù ${top?.displayName||"Someone"} leads with ${top?.count||0}. ${bottom?.displayName||"Someone"} is doing interpretive hunger at ${bottom?.count||0}.`,
    `üå≠ ‚ÄúPost the dog. Respectfully.‚Äù ${recent?.name||"Latest submitter"} dropped a receipt and now the rest of you look suspiciously bun-less.`,
    `üå≠ ‚ÄúEat now, negotiate later.‚Äù If you‚Äôre at ${bottom?.count||0}, that‚Äôs not ‚Äúlow‚Äù ‚Äî that‚Äôs ‚Äúconcerning.‚Äù`,
    `üå≠ ‚ÄúMustard is a mindset.‚Äù Today‚Äôs vibe: the top Dawg is speedrunning the year and leaving crumbs.`,
    `üå≠ ‚ÄúIf it‚Äôs not photographed, it didn‚Äôt happen.‚Äù No alibis. Only buns.`
  ];

  const tag = spicyOn()
    ? pick(["Also: that photo angle is doing crimes and getting away with it.", "Also: the condiments are loud and I approve.", "Also: bun confidence is at historic highs.", "Also: this is peer pressure with sparkles."])
    : pick(["Also: cinematic bun work.", "Also: the spreadsheet thanks you.", "Also: keep it silly, keep it honest.", "Also: this is our Super Bowl."]);

  return `${spicyOn() ? pick(spicy) : pick(mild)} ${tag}`;
}

/* =========================
   CALL OUTS
========================= */
function buildCallout(r, top, spicy){
  const d = r.displayName;
  const c = Number(r.count)||0;
  const delta = (Number(top.count)||0) - c;

  if(r.email === top.email){
    return spicy
      ? `üö® TOP DAWG üö® ${d} is eating like they hate peace (${c}). Bow to the bun.`
      : `üå≠ Top Dawg: ${d} leads with ${c}. Respect the bun.`;
  }
  if(delta <= 2 && delta >= 0){
    return spicy
      ? `${d} is one (1) hot dog away from becoming unbearable. Only ${delta} behind the top.`
      : `${d} is close ‚Äî only ${delta} behind the top. Time to cook.`;
  }
  if(c <= 2){
    return spicy
      ? `${d}, your count is so low it‚Äôs basically folklore. (${c}.) Fix it. üå≠`
      : `${d}, we miss your dawgs. (${c} total.) Post one soon.`;
  }
  return spicy
    ? `${d} has ${c} on the board. That‚Äôs fine‚Ä¶ but the top Dawg has ${top.count}. Choose violence (mustard).`
    : `${d} has ${c}. Top is ${top.count}. Plenty of runway ‚Äî go get it.`;
}

/* =========================
   GOOGLE SHEETS LOADER (GViz JSONP)
========================= */
function gvizQuery(sheetName, tq){
  return new Promise((resolve, reject) => {
    if(!window.google) window.google = {};
    if(!window.google.visualization) window.google.visualization = {};
    if(!window.google.visualization.Query) window.google.visualization.Query = {};

    const cbKey = "__gviz_cb_" + Math.random().toString(16).slice(2);
    window[cbKey] = (resp) => { cleanup(); resolve(resp); };
    window.google.visualization.Query.setResponse = window[cbKey];

    const script = document.createElement("script");
    const url = new URL(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq`);
    url.searchParams.set("tqx", "out:json");
    url.searchParams.set("sheet", sheetName);
    url.searchParams.set("tq", tq || "select *");
    url.searchParams.set("_", String(Date.now()));
    script.src = url.toString();
    script.async = true;

    const timer = setTimeout(() => {
      cleanup();
      reject(new Error("GViz request timed out"));
    }, 12000);

    script.onerror = () => {
      cleanup();
      reject(new Error("GViz request failed"));
    };

    function cleanup(){
      clearTimeout(timer);
      script.remove();
      delete window[cbKey];
    }

    document.head.appendChild(script);
  });
}

function gvizToObjects(resp){
  const cols = (resp && resp.table && resp.table.cols ? resp.table.cols : []).map(c => c.label || c.id || "");
  const rows = (resp && resp.table && resp.table.rows) ? resp.table.rows : [];
  const out = [];
  for(const r of rows){
    const obj = {};
    const cells = r.c || [];
    for(let i=0;i<cols.length;i++) {
      const key = cols[i] || ("col" + i);
      obj[key] = (cells[i] && ("v" in cells[i])) ? cells[i].v : null;
    }
    out.push(obj);
  }
  return out;
}

async function loadLiveData(){
  try {
    const tallyResp = await gvizQuery(TAB_TALLY, "select *");
    const tallyObjs = gvizToObjects(tallyResp);

    const newParticipants = [];
    for(const row of tallyObjs){
      const email = row["Email"] || row["Email Address"] || row["email"] || row["col1"];
      const name = row["Name"] || row["name"] || row["col2"];
      const count = Number(row["Count"] ?? row["count"] ?? row["col3"]);
      if(!email) continue;
      newParticipants.push({
        email: String(email).trim(),
        name: name ? String(name).trim() : "",
        count: isFinite(count) ? count : 0
      });
    }

    const respResp = await gvizQuery(TAB_RESPONSES, "select *");
    const respObjs = gvizToObjects(respResp);

    const newSubs = [];
    for(const row of respObjs){
      const ts = row["Timestamp"] || row["timestamp"] || row["col1"];
      const photo = row["Photo of dog in question"] || row["Photo"] || row["photo"] || row["col2"];
      const email = row["Email Address"] || row["Email"] || row["email"] || row["col3"];
      const name = row["Your name (will pull from previous answers)"] || row["Your name"] || row["Name"] || row["col4"];
      if(!ts || !email) continue;
      newSubs.push({
        ts: String(ts),
        photo: photo ? String(photo) : "",
        email: String(email).trim(),
        name: name ? String(name).trim() : ""
      });
    }

    newSubs.sort((a,b)=> parseDate(b.ts) - parseDate(a.ts));
    SUBMISSIONS = newSubs.slice(0, LOAD_SUBMISSIONS_LIMIT);
    PARTICIPANTS = newParticipants;

    $("#lastRefresh").textContent = new Date().toLocaleString([], {month:"short", day:"2-digit", hour:"2-digit", minute:"2-digit"});
    showToast("Fresh dawgs fetched üßæ");
    render();
  } catch(e) {
    console.warn("Live fetch failed:", e);
    showToast("Live fetch failed ‚Äî using last known data");
    render();
  }
}

/* =========================
   COMPUTE + RENDER
========================= */
function compute(scopeDays){
  const now = new Date();
  const cutoff = scopeDays === "all" ? null : new Date(now.getTime() - Number(scopeDays)*24*3600*1000);

  const subs = (SUBMISSIONS || [])
    .map(s => ({...s, d: parseDate(s.ts)}))
    .filter(s => !cutoff || (s.d && !isNaN(s.d.getTime()) && s.d >= cutoff))
    .sort((a,b)=> (b.d - a.d));

  const lastByEmail = new Map();
  for(const s of subs){
    const key = s.email || "";
    if(!key) continue;
    if(!lastByEmail.has(key)) lastByEmail.set(key, s.d);
  }

  const rows = (PARTICIPANTS || [])
    .map(p => ({
      ...p,
      displayName: (p.name && p.name.trim()) ? p.name.trim() : (p.email || "Unknown"),
      lastSeen: lastByEmail.get(p.email) || null
    }))
    .sort((a,b)=> (Number(b.count)||0) - (Number(a.count)||0) || (a.displayName||"").localeCompare(b.displayName||""));

  const totalDogs = rows.reduce((acc,r)=>acc + (Number(r.count)||0), 0);
  const top = rows[0] || {displayName:"‚Äî", count:0, email:""};

  return {rows, subs, totalDogs, top};
}

function render(){
  const scope = $("#scope").value;
  const q = ($("#q").value || "").trim().toLowerCase();
  const {rows, subs, totalDogs, top} = compute(scope);

  // header
  $("#asof").textContent = `Live from Google Sheets ‚Ä¢ Scope: ${scope === "all" ? "All time" : `last ${scope} days`} ‚Ä¢ Tabs: "${TAB_TALLY}", "${TAB_RESPONSES}"`;

  // quote
  $("#dailyQuote").textContent = buildDailyQuote(rows, subs);

  // stats
  animateInt($("#totalDogs"), totalDogs);
  $("#topDawg").textContent = `${top.displayName} (${top.count})`;

  const start = new Date("2026-01-01T00:00:00");
  const end = new Date("2026-12-31T23:59:59");
  const now = new Date();
  const totalSeasonDays = Math.max(1, Math.ceil((end - start) / (24*3600*1000)));

  // inclusive countdown: on Dec 31 show 1
  let daysLeft = 0;
  if (now <= end) {
    daysLeft = Math.floor((end - now) / (24*3600*1000)) + 1;
  }
  animateInt($("#daysLeft"), daysLeft);
  $("#refreshIntervalLabel").textContent = String(AUTO_REFRESH_MIN);

  $("#spark1").style.width = Math.min(100, 20 + (totalDogs % 80)) + "%";
  $("#spark2").style.width = Math.min(100, 25 + ((Number(top.count)||0) * 3)) + "%";
  $("#spark3").style.width = Math.max(2, Math.round((daysLeft / totalSeasonDays) * 100)) + "%";

  // leaderboard filter
  const filtered = rows.filter(r => {
    const a = (r.displayName||"").toLowerCase();
    const b = (r.email||"").toLowerCase();
    return !q || a.includes(q) || b.includes(q);
  });

  const max = rows.length ? (Number(rows[0].count)||1) : 1;
  const tbody = $("#tbody");
  tbody.innerHTML = "";

  filtered.forEach((r, idx) => {
    const tr = document.createElement("tr");
    const rank = idx + 1;

    const firstPhoto = (subs.find(s=>s.email===r.email)?.photo)||"";
    const id = driveIdFromUrl(firstPhoto);
    const ava = id ? `<img src="${driveThumb(firstPhoto)}" alt="" loading="lazy">` : initials(r.displayName);

    const last = (r.lastSeen && !isNaN(r.lastSeen.getTime())) ? r.lastSeen.toLocaleString([], {month:"short", day:"2-digit"}) : "‚Äî";
    const pct = max ? Math.max(2, Math.round(((Number(r.count)||0) / max) * 100)) : 0;

    tr.innerHTML = `
      <td class="rank">#${rank}</td>
      <td>
        <div class="namecell">
          <div class="avatar">${ava}</div>
          <div class="name">
            <b>${escapeHtml(r.displayName)}</b>
            <span>${escapeHtml(r.email)}</span>
          </div>
        </div>
      </td>
      <td class="count">${Number(r.count)||0}</td>
      <td>
        <div class="bar" title="${pct}% of top Dawg">
          <span style="width:${pct}%"></span>
        </div>
      </td>
      <td><span class="chip">üïµÔ∏è <strong>${last}</strong></span></td>
    `;

    tr.addEventListener("click", () => {
      copyText(buildCallout(r, top, spicyOn()));
    });

    tbody.appendChild(tr);
  });

  // feed
  const feed = $("#feed");
  feed.innerHTML = "";
  const useSubs = subs.slice(0, FEED_LIMIT);
  $("#latestCount").textContent = useSubs.length;

  const usedComments = new Set();
  useSubs.forEach((s) => {
    const name = (s.name && s.name.trim()) ? s.name.trim() : (rows.find(p=>p.email===s.email)?.displayName || s.email || "Unknown");
    const thumb = s.photo ? driveThumb(s.photo) : null;
    const comment = pickComment(name, spicyOn(), `${s.email}|${s.ts}|${s.photo}`, usedComments);

    const div = document.createElement("div");
    div.className = "post";
    div.innerHTML = `
      <div class="thumb">${thumb ? `<img src="${thumb}" alt="Hot dog submission photo" loading="lazy">` : ""}</div>
      <div>
        <div class="meta">
          <div>
            <b>${escapeHtml(name)}</b>
            <div class="t">${fmtDate(s.ts)} ‚Ä¢ <span class="chip">+1 dawg</span></div>
          </div>
          <div style="text-align:right">
            ${s.photo ? `<a href="${s.photo}" target="_blank" rel="noreferrer">Open</a>` : ""}
          </div>
        </div>
        <p>${escapeHtml(comment)}</p>
      </div>
    `;
    feed.appendChild(div);
  });

  // shame
  const shame = rows
    .filter(r => (r.displayName||"").toLowerCase() !== "unknown")
    .slice()
    .sort((a,b)=>(Number(a.count)||0)-(Number(b.count)||0))
    .slice(0, Math.min(6, rows.length));

  const shameList = $("#shameList");
  shameList.innerHTML = "";
  shame.forEach(r => {
    const c = Number(r.count)||0;
    const li = document.createElement("li");
    li.innerHTML = `<b>${escapeHtml(r.displayName)}</b> ‚Äî ${c} dawg${c===1?"":"s"}`;
    shameList.appendChild(li);
  });

  const heckles = $("#heckles");
  heckles.innerHTML = "";
  const pool = spicyOn() ? HECKLES_SPICY : HECKLES_MILD;
  // Pick 5 heckles deterministically per day so it feels fresh without flickering each render.
  const r = seededRandFromString(dailySeed() + (spicyOn() ? "|hs" : "|hm"));
  const idxs = new Set();
  while(idxs.size < Math.min(5, pool.length)){
    idxs.add(Math.floor(r() * pool.length));
  }
  Array.from(idxs).forEach(i => {
    const li = document.createElement("li");
    li.textContent = pool[i];
    heckles.appendChild(li);
  });
}

/* =========================
   EVENTS
========================= */
$("#scope").addEventListener("change", render);
$("#q").addEventListener("input", render);

$("#spicy").addEventListener("change", () => {
  render();
  showToast(spicyOn() ? "Spicy Mode: ON üå∂Ô∏è" : "Spicy Mode: OFF");
});

$("#celebrate").addEventListener("click", () => {
  confettiBurst();
  const {top} = compute($("#scope").value);
  showToast(`All hail ${top.displayName} üèÜ`);
});

$("#refreshNow").addEventListener("click", () => {
  loadLiveData();
});

// keyboard
document.addEventListener("keydown", (e) => {
  if(e.key === "/") {
    e.preventDefault();
    $("#q").focus();
  }
  if(e.key === "Escape") {
    $("#q").value = "";
    $("#q").blur();
    render();
  }
});

/* =========================
   BOOT
========================= */
render();
showToast("Spicy Mode: ON üå∂Ô∏è");

// Intro animation: fly a dawg into a hungry human, then remove.
(function(){
  const scene = document.getElementById("introScene");
  if(!scene) return;
  // Let it play longer, then fade out + remove
  setTimeout(() => scene.classList.add("done"), 3900);
  setTimeout(() => scene.remove(), 4400);
})();
loadLiveData();
setInterval(loadLiveData, AUTO_REFRESH_MIN * 60 * 1000);
</script>
</body>
</html>
